set (BASIC     basic/main.c)
set (EVENTS    events/main.c events/add.c events/resize.c events/move.c events/free.c lib/malloc_dynarr.c)
set (HELPERS   helpers/main.c)
set (REFERENCE reference/main.c reference/shared.c reference/common.c)

set (EXTENSIONS extensions/main.c lib/malloc_dynarr.c)
if (${TALLOC_DESTRUCTOR})
    set (EXTENSIONS ${EXTENSIONS} extensions/destructor.c)
endif ()

set (UTILS utils/main.c)
if (${TALLOC_UTILS_BUFFER})
    set (UTILS ${UTILS} utils/buffer.c)
endif ()
if (${TALLOC_UTILS_DYNARR})
    set (UTILS ${UTILS} utils/dynarr.c)
endif ()

if (${TALLOC_SHARED})
    add_executable (${TALLOC_TARGET}-basic ${BASIC})
    target_link_libraries (${TALLOC_TARGET}-basic ${TALLOC_TARGET})
    add_test (${TALLOC_TARGET}-basic ${TALLOC_TARGET}-basic)
    
    add_executable (${TALLOC_TARGET}-helpers ${HELPERS})
    target_link_libraries (${TALLOC_TARGET}-helpers ${TALLOC_TARGET})
    add_test (${TALLOC_TARGET}-helpers ${TALLOC_TARGET}-helpers)
    
    if (${TALLOC_DEBUG})
        add_executable (${TALLOC_TARGET}-events ${EVENTS})
        target_link_libraries (${TALLOC_TARGET}-events ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-events ${TALLOC_TARGET}-events)
    endif ()

    if (${TALLOC_EXTENSIONS})
        add_executable (${TALLOC_TARGET}-extensions ${EXTENSIONS})
        target_link_libraries (${TALLOC_TARGET}-extensions ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-extensions ${TALLOC_TARGET}-extensions)
    endif ()
    
    if (${TALLOC_REFERENCE})
        add_executable (${TALLOC_TARGET}-reference ${REFERENCE})
        target_link_libraries (${TALLOC_TARGET}-reference ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-reference ${TALLOC_TARGET}-reference)
    endif ()
    
    if (${TALLOC_UTILS})
        add_executable (${TALLOC_TARGET}-utils ${UTILS})
        target_link_libraries (${TALLOC_TARGET}-utils ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-utils ${TALLOC_TARGET}-utils)
    endif ()
endif ()
if (${TALLOC_STATIC})
    add_executable (${TALLOC_TARGET}-static-basic ${BASIC})
    target_link_libraries (${TALLOC_TARGET}-static-basic ${TALLOC_TARGET}_static)
    add_test (${TALLOC_TARGET}-static-basic ${TALLOC_TARGET}-static-basic)

    add_executable (${TALLOC_TARGET}-static-helpers ${HELPERS})
    target_link_libraries (${TALLOC_TARGET}-static-helpers ${TALLOC_TARGET}_static)
    add_test (${TALLOC_TARGET}-static-helpers ${TALLOC_TARGET}-static-helpers)
    
    if (${TALLOC_DEBUG})
        add_executable (${TALLOC_TARGET}-static-events ${HELPERS})
        target_link_libraries (${TALLOC_TARGET}-static-events ${TALLOC_TARGET}_static)
        add_test (${TALLOC_TARGET}-static-events ${TALLOC_TARGET}-static-events)
    endif ()

    if (${TALLOC_EXTENSIONS})
        add_executable (${TALLOC_TARGET}-static-extensions ${EXTENSIONS})
        target_link_libraries (${TALLOC_TARGET}-static-extensions ${TALLOC_TARGET}_static)
        add_test (${TALLOC_TARGET}-static-extensions ${TALLOC_TARGET}-static-extensions)
    endif ()
    
    if (${TALLOC_REFERENCE})
        add_executable (${TALLOC_TARGET}-static-reference ${REFERENCE})
        target_link_libraries (${TALLOC_TARGET}-static-reference ${TALLOC_TARGET}_static)
        add_test (${TALLOC_TARGET}-static-reference ${TALLOC_TARGET}-static-reference)
    endif ()
    
    if (${TALLOC_UTILS})
        add_executable (${TALLOC_TARGET}-static-utils ${UTILS})
        target_link_libraries (${TALLOC_TARGET}-static-utils ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-static-utils ${TALLOC_TARGET}-static-utils)
    endif ()
endif ()