set (BASIC     basic/main.c)
set (EVENTS    events/main.c events/add.c events/resize.c events/move.c events/free.c lib/malloc_dynarr.c)
set (HELPERS   helpers/main.c)
set (REFERENCE reference/main.c reference/shared.c reference/common.c)

set (EXTENSIONS extensions/main.c lib/malloc_dynarr.c)
if (${TALLOC_DESTRUCTOR})
    set (EXTENSIONS ${EXTENSIONS} extensions/destructor.c)
endif ()

set (UTILS utils/main.c)
if (${TALLOC_UTILS_BUFFER})
    set (UTILS ${UTILS} utils/buffer.c)
endif ()
if (${TALLOC_UTILS_DYNARR})
    set (UTILS ${UTILS} utils/dynarr.c)
endif ()

if (${TALLOC_SHARED})
    set (NAME ${TALLOC_TARGET}-test-basic)
    add_executable (${NAME} ${BASIC})
    target_link_libraries (${NAME} ${TALLOC_TARGET})
    add_test (${NAME} ${NAME})
    
    set (NAME ${TALLOC_TARGET}-test-helpers)
    add_executable (${NAME} ${HELPERS})
    target_link_libraries (${NAME} ${TALLOC_TARGET})
    add_test (${NAME} ${NAME})
    
    if (${TALLOC_DEBUG})
        set (NAME ${TALLOC_TARGET}-test-events)
        add_executable (${NAME} ${EVENTS})
        target_link_libraries (${NAME} ${TALLOC_TARGET})
        add_test (${NAME} ${NAME})
    endif ()

    if (${TALLOC_EXTENSIONS})
        set (NAME ${TALLOC_TARGET}-test-extensions)
        add_executable (${NAME} ${EXTENSIONS})
        target_link_libraries (${NAME} ${TALLOC_TARGET})
        add_test (${NAME} ${NAME})
    endif ()
    
    if (${TALLOC_REFERENCE})
        set (NAME ${TALLOC_TARGET}-test-reference)
        add_executable (${NAME} ${REFERENCE})
        target_link_libraries (${NAME} ${TALLOC_TARGET})
        add_test (${NAME} ${NAME})
    endif ()
    
    if (${TALLOC_UTILS})
        set (NAME ${TALLOC_TARGET}-test-utils)
        add_executable (${NAME} ${UTILS})
        target_link_libraries (${NAME} ${TALLOC_TARGET})
        add_test (${NAME} ${NAME})
    endif ()
endif ()
if (${TALLOC_STATIC})
    set (NAME ${TALLOC_TARGET}-static-test-basic)
    add_executable (${NAME} ${BASIC})
    target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
    add_test (${NAME} ${NAME})

    set (NAME ${TALLOC_TARGET}-static-test-helpers)
    add_executable (${NAME} ${HELPERS})
    target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
    add_test (${NAME} ${NAME})
    
    if (${TALLOC_DEBUG})
        set (NAME ${TALLOC_TARGET}-static-test-events)
        add_executable (${NAME} ${HELPERS})
        target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
        add_test (${NAME} ${NAME})
    endif ()

    if (${TALLOC_EXTENSIONS})
        set (NAME ${TALLOC_TARGET}-static-test-extensions)
        add_executable (${NAME} ${EXTENSIONS})
        target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
        add_test (${NAME} ${NAME})
    endif ()
    
    if (${TALLOC_REFERENCE})
        set (NAME ${TALLOC_TARGET}-static-test-reference)
        add_executable (${NAME} ${REFERENCE})
        target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
        add_test (${NAME} ${NAME})
    endif ()
    
    if (${TALLOC_UTILS})
        set (NAME ${TALLOC_TARGET}-static-test-utils)
        add_executable (${NAME} ${UTILS})
        target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
        add_test (${NAME} ${NAME})
    endif ()
endif ()