set (BASIC     basic/main.c lib/malloc_dynarr.c)
set (HELPERS   helpers/main.c)
set (EXT       ext/main.c lib/malloc_dynarr.c)
set (REFERENCE reference/main.c)
set (UTILS     utils/main.c)

if (TALLOC_SHARED MATCHES true)
    add_executable (${TALLOC_TARGET}-basic ${BASIC})
    target_link_libraries (${TALLOC_TARGET}-basic ${TALLOC_TARGET})
    add_test (${TALLOC_TARGET}-basic ${TALLOC_TARGET}-basic)

    add_executable (${TALLOC_TARGET}-helpers ${HELPERS})
    target_link_libraries (${TALLOC_TARGET}-helpers ${TALLOC_TARGET})
    add_test (${TALLOC_TARGET}-helpers ${TALLOC_TARGET}-helpers)

    if (TALLOC_EXT MATCHES true)
        add_executable (${TALLOC_TARGET}-ext ${EXT})
        target_link_libraries (${TALLOC_TARGET}-ext ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-ext ${TALLOC_TARGET}-ext)
    endif ()
    
    if (TALLOC_REFERENCE MATCHES true)
        add_executable (${TALLOC_TARGET}-reference ${REFERENCE})
        target_link_libraries (${TALLOC_TARGET}-reference ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-reference ${TALLOC_TARGET}-reference)
    endif ()
    
    if (TALLOC_UTILS MATCHES true)
        add_executable (${TALLOC_TARGET}-utils ${UTILS})
        target_link_libraries (${TALLOC_TARGET}-utils ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-utils ${TALLOC_TARGET}-utils)
    endif ()
endif ()

if (TALLOC_STATIC MATCHES true)
    add_executable (${TALLOC_TARGET}-static-basic ${BASIC})
    target_link_libraries (${TALLOC_TARGET}-static-basic ${TALLOC_TARGET}_static)
    add_test (${TALLOC_TARGET}-static-basic ${TALLOC_TARGET}-static-basic)

    add_executable (${TALLOC_TARGET}-static-helpers ${HELPERS})
    target_link_libraries (${TALLOC_TARGET}-static-helpers ${TALLOC_TARGET}_static)
    add_test (${TALLOC_TARGET}-static-helpers ${TALLOC_TARGET}-static-helpers)

    if (TALLOC_EXT MATCHES true)
        add_executable (${TALLOC_TARGET}-static-ext ${EXT})
        target_link_libraries (${TALLOC_TARGET}-static-ext ${TALLOC_TARGET}_static)
        add_test (${TALLOC_TARGET}-static-ext ${TALLOC_TARGET}-static-ext)
    endif ()
    
    if (TALLOC_REFERENCE MATCHES true)
        add_executable (${TALLOC_TARGET}-static-reference ${REFERENCE})
        target_link_libraries (${TALLOC_TARGET}-static-reference ${TALLOC_TARGET}_static)
        add_test (${TALLOC_TARGET}-static-reference ${TALLOC_TARGET}-static-reference)
    endif ()
    
    if (TALLOC_UTILS MATCHES true)
        add_executable (${TALLOC_TARGET}-static-utils ${UTILS})
        target_link_libraries (${TALLOC_TARGET}-static-utils ${TALLOC_TARGET})
        add_test (${TALLOC_TARGET}-static-utils ${TALLOC_TARGET}-static-utils)
    endif ()
endif ()