set (TREE tree.c)
set (HELPERS helpers.c)
set (DESTRUCTOR destructor.c)
set (REFERENCE reference.c)

if (${TALLOC_SHARED})
    set (NAME ${TALLOC_TARGET}-example-tree)
    add_executable (${NAME} ${TREE})
    target_link_libraries (${NAME} ${TALLOC_TARGET})
    add_test (${NAME} ${NAME})
    
    set (NAME ${TALLOC_TARGET}-example-helpers)
    add_executable (${TALLOC_TARGET}-example-helpers ${HELPERS})
    target_link_libraries (${TALLOC_TARGET}-example-helpers ${TALLOC_TARGET})
    add_test (${NAME} ${NAME})
    
    if (${TALLOC_DESTRUCTOR})
        set (NAME ${TALLOC_TARGET}-example-destructor)
        add_executable (${NAME} ${DESTRUCTOR})
        target_link_libraries (${NAME} ${TALLOC_TARGET})
        add_test (${NAME} ${NAME})
    endif ()
    if (${TALLOC_REFERENCE})
        find_package (Threads REQUIRED)
        set (NAME ${TALLOC_TARGET}-example-reference)
        add_executable (${NAME} ${REFERENCE})
        target_link_libraries (${NAME} ${TALLOC_TARGET} ${CMAKE_THREAD_LIBS_INIT})
        add_test (${NAME} ${NAME})
    endif ()
endif ()
if (${TALLOC_STATIC})
    set (NAME ${TALLOC_TARGET}-static-example-tree)
    add_executable (${NAME} ${TREE})
    target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
    add_test (${NAME} ${NAME})
    
    set (NAME ${TALLOC_TARGET}-static-example-helpers)
    add_executable (${NAME} ${HELPERS})
    target_link_libraries (${NAME} ${TALLOC_TARGET}_static)
    add_test (${NAME} ${NAME})
    
    if (${TALLOC_DESTRUCTOR})
        set (NAME ${TALLOC_TARGET}-static-example-destructor)
        add_executable (${NAME} ${DESTRUCTOR})
        target_link_libraries (${NAME} ${TALLOC_TARGET})
        add_test (${NAME} ${NAME})
    endif ()
    if (${TALLOC_REFERENCE})
        find_package (Threads REQUIRED)
        set (NAME ${TALLOC_TARGET}-static-example-reference)
        add_executable (${NAME} ${REFERENCE})
        target_link_libraries (${NAME} ${TALLOC_TARGET} ${CMAKE_THREAD_LIBS_INIT})
        add_test (${NAME} ${NAME})
    endif ()
endif ()